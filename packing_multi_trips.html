<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Travel Packing Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f7;
      color: #222;
    }
    header {
      background: #4b6cb7;
      background: linear-gradient(135deg, #4b6cb7, #182848);
      color: #fff;
      padding: 16px;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 1.4rem;
    }
    main {
      padding: 12px;
      max-width: 900px;
      margin: 0 auto;
    }
    .card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      padding: 12px 14px;
      margin-bottom: 12px;
    }
    .label {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: #777;
      margin-bottom: 4px;
    }
    input, button {
      font-family: inherit;
      font-size: 1rem;
    }
    input[type="text"], input[type="date"] {
      width: 100%;
      box-sizing: border-box;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 8px;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      background: #4b6cb7;
      color: white;
      font-weight: 600;
    }
    button.secondary {
      background: #eee;
      color: #333;
    }
    button.small {
      padding: 4px 10px;
      font-size: 0.8rem;
    }
    .trip-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    .trip-list-item:last-child {
      border-bottom: none;
    }
    .trip-title {
      font-weight: 600;
      margin-bottom: 2px;
    }
    .trip-meta {
      font-size: 0.85rem;
      color: #666;
    }
    .pill {
      display: inline-block;
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: #eef;
      color: #334;
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
      margin-bottom: 4px;
    }
    .section-header h3 {
      margin: 0;
      font-size: 1rem;
    }
    .section-items {
      margin-bottom: 8px;
    }
    .item-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
      font-size: 0.95rem;
    }
    .item-row input[type="checkbox"] {
      transform: scale(1.2);
    }
    .item-label {
      flex: 1;
    }
    .item-qty {
      width: 38px;
      text-align: center;
      border-radius: 4px;
      border: 1px solid #ccc;
      padding: 2px;
      font-size: 0.8rem;
    }
    .item-row.packed .item-label {
      text-decoration: line-through;
      color: #aaa;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }
    @media (min-width: 600px) {
      .trip-form-grid {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
<header>
  <h1>Travel Packing Planner</h1>
</header>
<main>
  <div class="card" id="new-trip-card">
    <div class="label">Create a Trip</div>
    <div class="trip-form-grid">
      <div>
        <input id="tripName" type="text" placeholder="Trip name (e.g., Branson Weekend)" />
      </div>
      <div>
        <input id="tripStart" type="date" />
      </div>
      <div>
        <input id="tripEnd" type="date" />
      </div>
    </div>
    <input id="tripDestination" type="text" placeholder="Destination (optional)" />
    <button onclick="addTrip()">Add Trip</button>
  </div>

  <div class="card" id="trip-list-card">
    <div class="label">Your Trips</div>
    <div id="tripList"></div>
  </div>

  <div class="card" id="trip-detail-card" style="display:none;">
    <div class="controls">
      <button class="secondary small" onclick="closeTripDetail()">Back to Trips</button>
      <button class="secondary small" onclick="resetTripPacking()">Uncheck All</button>
      <button class="secondary small" onclick="addCustomItem()">Add Custom Item</button>
      <button class="secondary small" onclick="deleteTrip()">Delete Trip</button>
    </div>
    <h2 id="detailTitle" style="margin-bottom:4px;"></h2>
    <div id="detailMeta" style="font-size:0.9rem; color:#666; margin-bottom:8px;"></div>
    <div id="packingSections"></div>
  </div>
</main>

<script>
  const STORAGE_KEY = "packingAppData_v1";

  let appData = { trips: [] };

  // Template for *new* trips
  function createDefaultSections() {
    return [
      {
        id: "clothing",
        name: "Clothing",
        items: [
          { id: "tops", label: "Tops / Shirts", qty: 4, packed: false },
          { id: "bottoms", label: "Pants / Shorts / Skirts", qty: 3, packed: false },
          { id: "pj", label: "Pajamas", qty: 2, packed: false },
          { id: "underwear", label: "Underwear", qty: 6, packed: false },
          { id: "socks", label: "Socks", qty: 6, packed: false },
          { id: "outerwear", label: "Jacket / Cardigan", qty: 1, packed: false },
          { id: "shoes", label: "Shoes / Sandals", qty: 2, packed: false }
        ]
      },
      {
        id: "toiletries",
        name: "Toiletries & Personal Care",
        items: [
          { id: "toothbrush", label: "Toothbrush & Toothpaste", qty: 1, packed: false },
          { id: "hair", label: "Brush / Comb / Hair ties", qty: 1, packed: false },
          { id: "shampoo", label: "Travel Shampoo / Conditioner", qty: 1, packed: false },
          { id: "bodywash", label: "Body wash / Soap", qty: 1, packed: false },
          { id: "deodorant", label: "Deodorant", qty: 1, packed: false },
          { id: "skincare", label: "Face wash / Skincare", qty: 1, packed: false },
          { id: "makeup", label: "Makeup & Remover", qty: 1, packed: false }
        ]
      },
      {
        id: "health",
        name: "Health, Meds & Devices",
        items: [
          { id: "daily-meds", label: "Daily Medications (sorted in pill organizer)", qty: 1, packed: false },
          { id: "prn-meds", label: "As-needed Meds (migraine, nausea, etc.)", qty: 1, packed: false },
          { id: "prescriptions", label: "Prescription bottles (if needed)", qty: 1, packed: false },
          { id: "cgm-supplies", label: "CGM / Glucose supplies", qty: 1, packed: false },
          { id: "surgery-docs", label: "Recent surgery / health paperwork", qty: 1, packed: false },
          { id: "vitamins", label: "Vitamins / Supplements", qty: 1, packed: false },
          { id: "first-aid", label: "Mini first-aid kit (Band-Aids, etc.)", qty: 1, packed: false }
        ]
      },
      {
        id: "tech",
        name: "Tech & Chargers",
        items: [
          { id: "phone-charger", label: "Phone charger & cable", qty: 1, packed: false },
          { id: "watch-charger", label: "Watch / device chargers", qty: 1, packed: false },
          { id: "powerbank", label: "Power bank", qty: 1, packed: false },
          { id: "earbuds", label: "Earbuds / Headphones", qty: 1, packed: false },
          { id: "tablet", label: "iPad / Tablet & charger", qty: 1, packed: false }
        ]
      },
      {
        id: "documents",
        name: "Wallet, Documents & Money",
        items: [
          { id: "id", label: "ID / Driver’s License", qty: 1, packed: false },
          { id: "insurance", label: "Insurance cards", qty: 1, packed: false },
          { id: "credit-cards", label: "Credit / Debit cards", qty: 1, packed: false },
          { id: "cash", label: "Cash / Tip money", qty: 1, packed: false },
          { id: "reservations", label: "Hotel / Tickets / Confirmations", qty: 1, packed: false }
        ]
      },
      {
        id: "dog",
        name: "Dog / Howie Stuff",
        items: [
          { id: "food", label: "Dog food + measuring scoop", qty: 1, packed: false },
          { id: "bowls", label: "Food & Water bowls", qty: 1, packed: false },
          { id: "treats", label: "Treats", qty: 1, packed: false },
          { id: "leash", label: "Leash & Harness", qty: 1, packed: false },
          { id: "poop-bags", label: "Poop bags", qty: 1, packed: false },
          { id: "bed-blanket", label: "Dog bed / blanket", qty: 1, packed: false },
          { id: "meds-dog", label: "Dog meds (if any)", qty: 1, packed: false }
        ]
      },
      {
        id: "other",
        name: "Extras & Nice-to-Haves",
        items: [
          { id: "snacks", label: "Snacks for travel", qty: 1, packed: false },
          { id: "water-bottle", label: "Refillable water bottle", qty: 1, packed: false },
          { id: "book", label: "Book / Kindle / Puzzle book", qty: 1, packed: false },
          { id: "blanket", label: "Small blanket / cardigan for car", qty: 1, packed: false },
          { id: "notes", label: "Notebook & pen", qty: 1, packed: false }
        ]
      }
    ];
  }

  // Preloaded Texas Christmas Trip
  function createTexasChristmasTrip() {
    return {
      id: "trip_texas_christmas",
      name: "Texas Christmas Trip",
      start: "",
      end: "",
      destination: "Texas",
      sections: [
        {
          id: "must_not_forget",
          name: "Must-Not-Forget (By the Door)",
          items: [
            { id: "mnf_daily_meds", label: "All daily medications (AM & PM)", qty: 1, packed: false },
            { id: "mnf_as_needed", label: "As-needed meds (migraine, tummy, nausea, sleep)", qty: 1, packed: false },
            { id: "mnf_med_list", label: "Prescription list / med list (for ER/urgent care)", qty: 1, packed: false },
            { id: "mnf_gifts", label: "Christmas gifts (all recipients)", qty: 1, packed: false },
            { id: "mnf_stocking_stuffers", label: "Stocking stuffers", qty: 1, packed: false },
            { id: "mnf_wallet", label: "Wallet (ID, cards, insurance)", qty: 1, packed: false },
            { id: "mnf_phone", label: "Phone & charger", qty: 1, packed: false }
          ]
        },
        {
          id: "meds_health",
          name: "Meds & Health",
          items: [
            { id: "mh_daily", label: "Daily meds (sorted in pill organizer)", qty: 1, packed: false },
            { id: "mh_migraine", label: "As-needed: migraine meds", qty: 1, packed: false },
            { id: "mh_nausea", label: "As-needed: nausea meds", qty: 1, packed: false },
            { id: "mh_tummy", label: "As-needed: tummy / bowel meds", qty: 1, packed: false },
            { id: "mh_pain_relief", label: "As-needed: pain reliever", qty: 1, packed: false },
            { id: "mh_vitamins", label: "Vitamins / supplements", qty: 1, packed: false },
            { id: "mh_paperwork", label: "Recent surgery paperwork / doctor info", qty: 1, packed: false },
            { id: "mh_cgm_sensors", label: "CGM / glucose: sensors", qty: 1, packed: false },
            { id: "mh_cgm_wipes", label: "CGM / glucose: alcohol wipes", qty: 1, packed: false },
            { id: "mh_cgm_reader", label: "CGM reader / app set up", qty: 1, packed: false },
            { id: "mh_firstaid_band", label: "Mini first-aid: Band-Aids", qty: 1, packed: false },
            { id: "mh_firstaid_wipes", label: "Mini first-aid: antiseptic wipes", qty: 1, packed: false },
            { id: "mh_firstaid_ointment", label: "Mini first-aid: ointment (if used)", qty: 1, packed: false }
          ]
        },
        {
          id: "christmas_gifts",
          name: "Christmas & Gifts",
          items: [
            { id: "cg_wrapped", label: "Wrapped gifts (check: Mom, Grandma, etc.)", qty: 1, packed: false },
            { id: "cg_backup_gifts", label: "Extra small backup gifts", qty: 1, packed: false },
            { id: "cg_stocking", label: "Stocking stuffers", qty: 1, packed: false },
            { id: "cg_gift_cards", label: "Gift cards", qty: 1, packed: false },
            { id: "cg_bags_tissue", label: "Gift bags & tissue paper", qty: 1, packed: false },
            { id: "cg_tape_scissors", label: "Tape, scissors, tags, pens", qty: 1, packed: false },
            { id: "cg_christmas_pjs", label: "Matching Christmas pajamas", qty: 1, packed: false },
            { id: "cg_christmas_top", label: "Christmas top/outfit for photos", qty: 1, packed: false },
            { id: "cg_accessories", label: "Christmas accessories (earrings, headbands, etc.)", qty: 1, packed: false }
          ]
        },
        {
          id: "clothing_tx",
          name: "Clothing (Texas Christmas)",
          items: [
            { id: "cl_casual_tops", label: "Casual tops", qty: 3, packed: false },
            { id: "cl_nice_tops", label: "Nice tops (going out / Christmas day)", qty: 2, packed: false },
            { id: "cl_bottoms", label: "Pants / jeans / leggings", qty: 3, packed: false },
            { id: "cl_pjs", label: "Pajamas", qty: 2, packed: false },
            { id: "cl_xmas_pjs", label: "Christmas PJs", qty: 1, packed: false },
            { id: "cl_underwear", label: "Underwear & bras", qty: 6, packed: false },
            { id: "cl_socks", label: "Socks (extra for cold floors)", qty: 6, packed: false },
            { id: "cl_sweater", label: "Sweater/cardigan or zip-up hoodie", qty: 1, packed: false },
            { id: "cl_jacket", label: "Jacket (light or medium weight)", qty: 1, packed: false },
            { id: "cl_shoes", label: "Everyday shoes", qty: 1, packed: false },
            { id: "cl_comfy_shoes", label: "Comfy slip-ons / house shoes", qty: 1, packed: false },
            { id: "cl_optional_cold", label: "Optional: scarf / gloves / hat", qty: 1, packed: false },
            { id: "cl_slippers", label: "Slippers", qty: 1, packed: false }
          ]
        },
        {
          id: "toiletries_tx",
          name: "Toiletries & Personal Care",
          items: [
            { id: "toothbrush_t", label: "Toothbrush & toothpaste", qty: 1, packed: false },
            { id: "floss_mouthwash", label: "Floss / mouthwash (if you use it)", qty: 1, packed: false },
            { id: "hairbrush", label: "Hairbrush / comb", qty: 1, packed: false },
            { id: "hair_ties", label: "Hair ties / clips", qty: 1, packed: false },
            { id: "shampoo_cond", label: "Shampoo & conditioner (travel if needed)", qty: 1, packed: false },
            { id: "bodywash_soap", label: "Body wash / soap", qty: 1, packed: false },
            { id: "razor", label: "Razor (if needed)", qty: 1, packed: false },
            { id: "deodorant_t", label: "Deodorant", qty: 1, packed: false },
            { id: "skincare_cleanser", label: "Skincare: cleanser", qty: 1, packed: false },
            { id: "skincare_moist", label: "Skincare: moisturizer", qty: 1, packed: false },
            { id: "skincare_treatments", label: "Skincare: treatment creams (if any)", qty: 1, packed: false },
            { id: "makeup_t", label: "Makeup", qty: 1, packed: false },
            { id: "makeup_remover", label: "Makeup remover / wipes", qty: 1, packed: false },
            { id: "lip_balm", label: "Lip balm (for winter air)", qty: 1, packed: false },
            { id: "contacts", label: "Contacts / solution / case (if you wear)", qty: 1, packed: false },
            { id: "feminine_products", label: "Feminine products (just in case)", qty: 1, packed: false }
          ]
        },
        {
          id: "tech_tx",
          name: "Tech & Chargers",
          items: [
            { id: "phone", label: "Phone", qty: 1, packed: false },
            { id: "phone_charger_1", label: "Phone charger (1)", qty: 1, packed: false },
            { id: "phone_charger_2", label: "Phone charger (2nd / backup)", qty: 1, packed: false },
            { id: "watch_charger", label: "Watch charger", qty: 1, packed: false },
            { id: "tablet_t", label: "iPad / tablet & charger", qty: 1, packed: false },
            { id: "powerbank_t", label: "Power bank", qty: 1, packed: false },
            { id: "car_charger", label: "Car charger / USB adapter", qty: 1, packed: false },
            { id: "earbuds_t", label: "Earbuds / headphones", qty: 1, packed: false }
          ]
        },
        {
          id: "car_comfort_tx",
          name: "Car & Comfort",
          items: [
            { id: "car_tote", label: "Small tote/purse with wallet + day meds + lip balm + tissues", qty: 1, packed: false },
            { id: "car_snacks", label: "Travel snacks (blood-sugar friendly)", qty: 1, packed: false },
            { id: "car_water", label: "Refillable water bottle", qty: 1, packed: false },
            { id: "car_blanket", label: "Small blanket or cardigan in car", qty: 1, packed: false },
            { id: "car_neck_pillow", label: "Neck pillow (if long drive)", qty: 1, packed: false },
            { id: "car_trash_bag", label: "Trash bag / grocery bag for trash", qty: 1, packed: false },
            { id: "car_sanitizer", label: "Hand sanitizer & wipes", qty: 1, packed: false }
          ]
        },
        {
          id: "howie_tx",
          name: "Howie’s Stuff",
          items: [
            { id: "dog_food", label: "Dog food + measuring scoop", qty: 1, packed: false },
            { id: "dog_bowls", label: "Food & water bowls", qty: 1, packed: false },
            { id: "dog_treats", label: "Treats", qty: 1, packed: false },
            { id: "dog_leash", label: "Leash & harness", qty: 1, packed: false },
            { id: "dog_poop_bags", label: "Poop bags", qty: 1, packed: false },
            { id: "dog_bed_blanket", label: "Dog bed / blanket (smells like home)", qty: 1, packed: false },
            { id: "dog_toys", label: "Toys / chew", qty: 1, packed: false },
            { id: "dog_meds", label: "Dog meds (if any)", qty: 1, packed: false },
            { id: "dog_vet_info", label: "Vet info saved in phone (clinic number)", qty: 1, packed: false }
          ]
        },
        {
          id: "optional_extras_tx",
          name: "Optional Extras",
          items: [
            { id: "opt_notebook", label: "Notebook & pens", qty: 1, packed: false },
            { id: "opt_book", label: "Book / Kindle / puzzle book", qty: 1, packed: false },
            { id: "opt_reusable_bag", label: "Reusable shopping bag", qty: 1, packed: false },
            { id: "opt_laundry_bag", label: "Laundry bag for dirty clothes", qty: 1, packed: false },
            { id: "opt_extra_cable", label: "Extra phone charging cable", qty: 1, packed: false }
          ]
        }
      ]
    };
  }

  function loadData() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      try {
        appData = JSON.parse(raw);
      } catch (e) {
        console.error("Error parsing saved data, resetting.", e);
        appData = { trips: [] };
      }
    } else {
      appData = { trips: [] };
    }

    if (!Array.isArray(appData.trips)) appData.trips = [];

    // If nothing yet, preload Texas Christmas Trip
    if (appData.trips.length === 0) {
      appData.trips.push(createTexasChristmasTrip());
      saveData();
    }
  }

  function saveData() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
  }

  // Trips
  function addTrip() {
    const nameEl = document.getElementById("tripName");
    const startEl = document.getElementById("tripStart");
    const endEl = document.getElementById("tripEnd");
    const destEl = document.getElementById("tripDestination");

    const name = nameEl.value.trim();
    const start = startEl.value;
    const end = endEl.value;
    const dest = destEl.value.trim();

    if (!name) {
      alert("Please enter a trip name.");
      return;
    }

    const trip = {
      id: "trip_" + Date.now(),
      name,
      start,
      end,
      destination: dest,
      sections: createDefaultSections()
    };

    appData.trips.push(trip);
    saveData();
    renderTripList();

    nameEl.value = "";
    startEl.value = "";
    endEl.value = "";
    destEl.value = "";
  }

  function deleteTrip() {
    if (!currentTripId) return;
    const confirmDelete = confirm("Delete this trip and all its packing data?");
    if (!confirmDelete) return;

    appData.trips = appData.trips.filter(t => t.id !== currentTripId);
    saveData();
    closeTripDetail();
    renderTripList();
  }

  function renderTripList() {
    const list = document.getElementById("tripList");
    list.innerHTML = "";

    if (!appData.trips.length) {
      list.innerHTML = "<p style='color:#777; font-size:0.9rem;'>No trips yet. Create one above to get started.</p>";
      return;
    }

    appData.trips
      .slice()
      .sort((a, b) => (a.start || "").localeCompare(b.start || ""))
      .forEach(trip => {
        const div = document.createElement("div");
        div.className = "trip-list-item";

        const left = document.createElement("div");
        const title = document.createElement("div");
        title.className = "trip-title";
        title.textContent = trip.name;
        left.appendChild(title);

        const meta = document.createElement("div");
        meta.className = "trip-meta";
        const parts = [];
        if (trip.destination) parts.push(trip.destination);
        if (trip.start || trip.end) parts.push(`${trip.start || "?"} → ${trip.end || "?"}`);
        meta.textContent = parts.join(" • ") || "No dates set";
        left.appendChild(meta);

        div.appendChild(left);

        const right = document.createElement("div");
        const btn = document.createElement("button");
        btn.className = "small";
        btn.textContent = "Open";
        btn.onclick = () => openTripDetail(trip.id);
        right.appendChild(btn);
        div.appendChild(right);

        list.appendChild(div);
      });
  }

  let currentTripId = null;

  function findCurrentTrip() {
    return appData.trips.find(t => t.id === currentTripId) || null;
  }

  function openTripDetail(tripId) {
    currentTripId = tripId;
    const trip = findCurrentTrip();
    if (!trip) return;

    document.getElementById("trip-detail-card").style.display = "block";
    document.getElementById("trip-list-card").style.display = "none";
    document.getElementById("new-trip-card").style.display = "none";

    document.getElementById("detailTitle").textContent = trip.name;

    const metaParts = [];
    if (trip.destination) metaParts.push(trip.destination);
    if (trip.start || trip.end) metaParts.push(`${trip.start || "?"} → ${trip.end || "?"}`);
    document.getElementById("detailMeta").textContent = metaParts.join(" • ");

    renderPackingSections(trip);
  }

  function closeTripDetail() {
    currentTripId = null;
    document.getElementById("trip-detail-card").style.display = "none";
    document.getElementById("trip-list-card").style.display = "block";
    document.getElementById("new-trip-card").style.display = "block";
  }

  function renderPackingSections(trip) {
    const container = document.getElementById("packingSections");
    container.innerHTML = "";

    trip.sections.forEach(section => {
      const secDiv = document.createElement("div");

      const header = document.createElement("div");
      header.className = "section-header";

      const h3 = document.createElement("h3");
      h3.textContent = section.name;
      header.appendChild(h3);

      const countSpan = document.createElement("span");
      const total = section.items.length;
      const packedCount = section.items.filter(i => i.packed).length;
      countSpan.className = "pill";
      countSpan.textContent = `${packedCount}/${total} packed`;
      header.appendChild(countSpan);

      secDiv.appendChild(header);

      const itemsDiv = document.createElement("div");
      itemsDiv.className = "section-items";

      section.items.forEach(item => {
        const row = document.createElement("div");
        row.className = "item-row";
        if (item.packed) row.classList.add("packed");

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = item.packed;
        cb.onchange = () => togglePacked(section.id, item.id);

        const labelDiv = document.createElement("div");
        labelDiv.className = "item-label";
        labelDiv.textContent = item.label;

        const qtyInput = document.createElement("input");
        qtyInput.className = "item-qty";
        qtyInput.type = "number";
        qtyInput.min = "0";
        qtyInput.value = item.qty ?? 1;
        qtyInput.onchange = () => updateQuantity(section.id, item.id, qtyInput.value);

        const qtyLabel = document.createElement("span");
        qtyLabel.style.fontSize = "0.75rem";
        qtyLabel.style.color = "#777";
        qtyLabel.textContent = "qty";

        row.appendChild(cb);
        row.appendChild(labelDiv);
        row.appendChild(qtyInput);
        row.appendChild(qtyLabel);

        itemsDiv.appendChild(row);
      });

      secDiv.appendChild(itemsDiv);
      container.appendChild(secDiv);
    });
  }

  function togglePacked(sectionId, itemId) {
    const trip = findCurrentTrip();
    if (!trip) return;
    const sec = trip.sections.find(s => s.id === sectionId);
    if (!sec) return;
    const item = sec.items.find(i => i.id === itemId);
    if (!item) return;

    item.packed = !item.packed;
    saveData();
    renderPackingSections(trip);
  }

  function updateQuantity(sectionId, itemId, value) {
    const qty = parseInt(value || "0", 10);
    const trip = findCurrentTrip();
    if (!trip) return;
    const sec = trip.sections.find(s => s.id === sectionId);
    if (!sec) return;
    const item = sec.items.find(i => i.id === itemId);
    if (!item) return;

    item.qty = qty;
    saveData();
  }

  function resetTripPacking() {
    const trip = findCurrentTrip();
    if (!trip) return;
    trip.sections.forEach(sec => {
      sec.items.forEach(item => (item.packed = false));
    });
    saveData();
    renderPackingSections(trip);
  }

  function addCustomItem() {
    const trip = findCurrentTrip();
    if (!trip) return;

    const sectionNames = trip.sections.map(s => s.name);
    const sectionPrompt = "Which section? (Type exactly or leave blank for 'Extras & Nice-to-Haves'):\n\n" +
      sectionNames.join("\n");
    let sectionName = prompt(sectionPrompt, "Extras & Nice-to-Haves");
    if (sectionName === null) return;

    sectionName = sectionName.trim();
    if (!sectionName) sectionName = "Extras & Nice-to-Haves";

    let section = trip.sections.find(s => s.name.toLowerCase() === sectionName.toLowerCase());
    if (!section) {
      section = {
        id: "custom_" + Date.now(),
        name: sectionName,
        items: []
      };
      trip.sections.push(section);
    }

    const label = prompt("What do you want to add? (e.g., 'Christmas pajamas', 'Gift bag for Mom'):");
    if (!label || !label.trim()) return;

    const qtyStr = prompt("Quantity?", "1");
    const qty = parseInt(qtyStr || "1", 10);

    section.items.push({
      id: "item_" + Date.now(),
      label: label.trim(),
      qty: qty,
      packed: false
    });

    saveData();
    renderPackingSections(trip);
  }

  loadData();
  renderTripList();
</script>
</body>
</html>
